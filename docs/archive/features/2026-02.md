# February 2026 Features (Archived)

**Archived from:** `docs/claude-context/recent-features.md`
**Current features list:** `docs/claude-context/site-features.md`

---

### Trending Hotspots Component (Feb 8, 2026)

**Context:** With 2,408 active users, page views per session needed improvement. Users were reading one crime story and leaving.

**What Was Implemented:**
- "Hot Areas This Week" — Top 5 areas by crime count (last 7 days), server-rendered, zero additional API calls
- "Your Recent Views" — Last 3 crime pages visited (localStorage), 20-entry rolling buffer, dedup by slug
- Heat dot intensity by rank: rose-500 → rose-400 → rose-300
- Placement: crime detail pages (between article + SafetyContext) and CrimeDetailModal

**Files Created:** `src/lib/trendingHelpers.ts`, `src/components/TrendingHotspots.astro`
**Files Modified:** `safetyHelpers.ts` (exported `toDate()`), `modalHtmlGenerators.ts` (`generateTrendingHotspotsHTML()`)

---

### Link Checker Automation (Feb 7, 2026)

**Context:** News sites take down articles over time. Dead source links degrade user trust and SEO.

**What Was Implemented:**
- `linkChecker.gs` — Checks all news article source URLs in 2025 + 2026 CSVs
- Bi-weekly triggers (1st and 15th of month at 8 AM Trinidad time)
- Parallel batch checking via `UrlFetchApp.fetchAll()` (50 URLs per batch)
- HEAD-first, GET-retry strategy for servers rejecting HEAD (405/501)
- Trigger chaining for GAS 5-min execution limit (CacheService state persistence)
- Email report sorted by crime count impact
- Social media URLs excluded

**Files Created:** `google-apps-script/trinidad/linkChecker.gs`
**Dependencies:** `config.gs` (NOTIFICATION_EMAIL), `socialMediaStats.gs` (parseCSV)

---

### UX Navigation Overhaul (Feb 5, 2026)

**Context:** UX audit revealed mobile navigation reduced discoverability by ~50%. Horizontal pills + hamburger created redundancy.

**Phase 1: Bottom Tab Bar** — `BottomNav.astro`, 4 primary sections + "More" menu, safe area support for iPhone X+, config-driven from `countries.ts` (`showInBottomNav`, `icon` fields)

**Phase 2: Direct Links** — Header.astro detects `/trinidad/*` pages, uses direct `<a>` links (1 tap) instead of modals

**Phase 3: Active Indicators** — Desktop underline + mobile dot on active section, `getActiveSection()` helper

**Phase 4: Related Crimes** — `RelatedCrimes.astro`, same area priority → same crime type fallback, compact card design

**Phase 5: Footer Nav** — Added "Browse" column with primary navigation links

**Files Created:** `BottomNav.astro`, `RelatedCrimes.astro`
**Files Modified:** `Layout.astro`, `Header.astro`, `countries.ts`, `[slug].astro`

---

### Weekly Blog Automation (Feb 6, 2026)

**Context:** Needed automatic weekly blog content generation and publishing.

**Flow:** Monday 10 AM trigger → validate (4 safeguards) → CSV stats → Claude Haiku writes blog → GitHub commit → Cloudflare deploys

**4-Layer Validation:** minimum crimes (10), data freshness, backlog check, duplicate detection

**Cost:** ~$0.01-0.03 per blog post (Claude Haiku 4.5)

**Critical Lesson:** GAS sheet `.getDataRange().getValues()` returns Date objects in GMT, but `new Date()` uses script timezone. Always use CSV-based `fetchCrimeData()` + `filterCrimesByDateRange()`.

**Files Created:** `weeklyBlogAutomation.gs`
**Dependencies:** `config.gs`, `socialMediaStats.gs`, `blogDataGenerator.gs`
**Script Properties:** `CLAUDE_API_KEY`, `GITHUB_TOKEN`, `GITHUB_REPO`, `TRINIDAD_CSV_URL`

---

### CrimeDetailModal Refactoring (Feb 6, 2026)

**What:** 918 → 261 lines. Thin orchestrator importing 5 focused modules.

**Modules:** `modalHtmlGenerators.ts`, `modalFeedbackHandler.ts`, `modalShareHandlers.ts`, `modalReportHandler.ts`, `modalLifecycle.ts`

**Eliminated duplicates:** `escapeHtml`, `sanitizeUrl`, `calculateAreaSafetyContext`, `getCrimeColorHex` — now imported from shared `src/lib/` modules

**Gotchas:**
- `bindRelatedCrimeLinks()` stays in orchestrator (references `openCrimeModal` directly)
- Area detail pages populate `window.__crimesData` with only `areaCrimes`

---

### Section Picker Modal (Feb 2, 2026)

Homepage island click opens section picker modal instead of navigating directly to dashboard. Sections driven from `countries.ts` config. Coming-soon islands unchanged.

**Files Created:** `SectionPickerModal.astro`
**Files Modified:** `countries.ts`, `index.astro`

---

### Facebook Post Submitter (Feb 2, 2026)

GAS web app for quick Facebook crime post entry. Paste text + URL → Claude Haiku extracts → Production sheet (bypasses confidence check). Year toggle: 2026 → pipeline, 2025 → FR1 sheet. Primary Guardian source (Guardian has no RSS feed).

**Files Created:** `facebookSubmitter.gs`

---

### Modal Pageview Tracking (Feb 2, 2026)

`pushState` on modal open → both GA4 and Cloudflare Web Analytics detect pageview. `popstate` listener closes modal on browser back button. `skipHistory` flag prevents race condition.

**Files Modified:** `CrimeDetailModal.astro`
