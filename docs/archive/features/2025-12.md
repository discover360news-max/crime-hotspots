# December 2025 Features (Archived)

**Archived from:** `docs/claude-context/recent-features.md`
**Current features list:** `docs/claude-context/site-features.md`

---

### Site Notification Banner & 2026 Crime Type System (Dec 28)

Toggle-based notification system (`siteNotifications.ts`). Dismissible banner with localStorage persistence. 2026 primary + related crime types (one incident = one row). Column header mapping for CSV resilience. `countCrimeType()` counts across primary + related fields.

**Files:** `siteNotifications.ts`, `SiteNotificationBanner.astro`, `crimeTypeProcessor.gs`, `crimeData.ts`, `dashboardUpdates.ts`

---

### Site-Wide Search (Dec 27)

Pagefind static search with WebAssembly (1,584 crime pages indexed). SearchModal with Ctrl+K shortcut, frosted glass design. `data-pagefind-ignore` on modals, headers, footers. Manual CLI approach (`npx pagefind --site dist`).

**Files:** `SearchModal.astro`, `Layout.astro`, `astro.config.mjs`

---

### Dashboard Trend Indicators + Modal Navigation (Dec 26)

30-day trend comparisons on all stat cards (last 30 vs previous 30 days, 3-day lag offset). HeadlinesModal and ArchivesModal for instant island selection. Monthly archive redesign. Cloudflare Turnstile CAPTCHA integration (invisible mode).

---

### Dashboard UX & Loading States (Dec 23)

InfoPopup component (click-based help tooltips). LoadingShimmer component (Facebook-style, 500ms minimum). ReportIssueModal for user corrections. Map two-finger pan controls. Changed "regions" to "areas".

**Key:** Fixed-height containers prevent CLS (Stats: 140px, Map: 600px, Insights: 400px).

---

### Dashboard Refactoring & Clickable Stat Cards (Dec 23)

Extracted scripts: `statCardFiltering.ts` (200 lines), `dashboardUpdates.ts` (160 lines). Dashboard 876 → 592 lines (32% reduction). Clickable stat cards for one-click filtering with tray sync.

---

### Year Filter System (Dec 18)

Default to current year on load. Year filter dropdown in filter tray. Smart data loading prevents duplicate fetching. Synchronized CSV URLs across `crimeData.ts` (server) and `dashboard.astro` (client).

---

### Dashboard Refactoring (Dec 19)

Extracted: `yearFilter.ts` (159 lines), `leafletMap.ts` (287 lines), `statsScroll.ts` (33 lines). Created `FiltersTray.astro` (87 lines). Dashboard 1,011 → 579 lines (43% reduction).

---

### Enhanced Duplicate Detection & Seizures Crime Type (Dec 3)

Duplicate detection checks both Production + Archive sheets. Added "Seizures" crime type for police enforcement actions.

**Files:** `processor.gs`, `geminiClient.gs`
