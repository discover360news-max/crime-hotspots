---
/**
 * Trinidad & Tobago Crime Dashboard
 * Interactive dashboard with regional SVG map and Leaflet incidents map
 */

// Keep dashboard static (pre-rendered at build time)
export const prerender = true;

import Layout from '../../layouts/Layout.astro';
import { getTrinidadCrimes } from '../../lib/crimeData';
import { countCrimeType, calculateInsights } from '../../lib/dashboardHelpers';
import Breadcrumbs from '../../components/Breadcrumbs.astro';
import StatCard from '../../components/StatCard.astro';
import QuickInsightsCard from '../../components/QuickInsightsCard.astro';
import TopRegionsCard from '../../components/TopRegionsCard.astro';
import DashboardInfoCards from '../../components/DashboardInfoCards.astro';
import FiltersTray from '../../components/FiltersTray.astro';
import InfoPopup from '../../components/InfoPopup.astro';
import LoadingShimmer from '../../components/LoadingShimmer.astro';
import SiteNotificationBanner from '../../components/SiteNotificationBanner.astro';
import { dataUpdateNotice } from '../../config/siteNotifications';
import { getCountryName } from '../../data/countries';
import { routes } from '../../config/routes';
import '../../styles/dashboard.css';

// Get all crimes (will be used for year filtering on client-side)
const allCrimes = await getTrinidadCrimes();

// Get available years for dropdown (sorted descending)
const availableYears = [...new Set(allCrimes.map(c => c.year))].sort((a, b) => b - a);

// Use the highest year in the data as "current" (not calendar year)
// This ensures we show the latest data, even if it's from a different year
const currentYear = availableYears[0];

// Filter to current year by default (server-side initial render)
const crimes = allCrimes.filter(crime => crime.year === currentYear);

// Calculate insights using imported helper
const insights = calculateInsights(crimes);

// Most recent crime date for freshness indicator
const latestCrimeDate = crimes[0]?.dateObj ?? new Date();
const freshnessText = latestCrimeDate.toLocaleDateString('en-GB', { day: 'numeric', month: 'short', year: 'numeric' });

const title = "Trinidad Crime Dashboard 2026 - Murder Count, Statistics & Live Map";
const description = "Track Trinidad & Tobago crime statistics for 2026. Live murder count, robbery rates, and incident map. Updated daily with the latest crime data.";
---


<Layout title={title} description={description} includeLeaflet={true} includeTurnstile={true}>

  <div class="container mx-auto px-4 py-2 max-w-7xl" data-pagefind-ignore>
    <!-- Page Header -->
    <div class="pt-4 mb-4">
      <Breadcrumbs items={[
        { label: 'Home', href: '/' },
        { label: getCountryName('tt') }
      ]} />
      <div class="flex items-start justify-between gap-10 pt-4">
        <div>
          <h1 class="text-2xl font-bold text-slate-700">Trinidad & Tobago</h1>
          <p class="text-xs text-slate-500">Crime Statistics Dashboard <span id="dashboardYear" class="font-medium text-slate-600">for {currentYear}</span></p>
          <p id="dataFreshness" class="text-xs text-slate-400 mt-0.5 flex items-center gap-1">
            <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
            Data as of {freshnessText}
          </p>
        </div>
        <div class="flex flex-col gap-2">
          <a href={routes.trinidad.headlines}
            class="px-4 py-1.5 min-h-[22px] flex items-center justify-center border border-rose-600 text-rose-600 rounded-lg hover:bg-rose-50 active:bg-rose-100 transition font-medium text-xs whitespace-nowrap">
            Headlines
          </a>

          <button id="filtersBtn"
            class="px-4 py-1.5 min-h-[22px] flex items-center justify-center border border-rose-600 text-rose-600 rounded-lg hover:bg-rose-50 active:bg-rose-100 transition font-medium text-xs whitespace-nowrap">
            Filters â€º
          </button>
        </div>
      </div>
    </div>

    <!-- Separator -->
    <div class="w-full h-px bg-gradient-to-r from-transparent via-slate-300 to-transparent mb-4"></div>

    <!-- Site Notification Banner -->
    <SiteNotificationBanner notification={dataUpdateNotice} />

    <!-- Statistics Cards - Horizontal Scroll -->
    <div class="flex items-center gap-1 mb-2">
      <h2 class="sr-only">Crime Statistics</h2>
      <InfoPopup id="crime-types-info">
        <p class="font-semibold mb-2 text-rose-700">Crime Type Definitions</p>
        <ul class="space-y-1.5">
          <li><span class="font-medium text-slate-700">Murder</span> â€” Fatal violent crime</li>
          <li><span class="font-medium text-slate-700">Robbery</span> â€” Theft with force or threat of force</li>
          <li><span class="font-medium text-slate-700">Shooting</span> â€” Firearm discharge incident</li>
          <li><span class="font-medium text-slate-700">Home Invasion</span> â€” Forced entry into an occupied residence</li>
          <li><span class="font-medium text-slate-700">Seizures</span> â€” Confiscation of drugs, firearms, or contraband</li>
          <li><span class="font-medium text-slate-700">Assault</span> â€” Physical attack causing bodily harm</li>
          <li><span class="font-medium text-slate-700">Burglary</span> â€” Unlawful entry with intent to steal (unoccupied)</li>
          <li><span class="font-medium text-slate-700">Theft</span> â€” Property taken without force</li>
          <li><span class="font-medium text-slate-700">Kidnapping</span> â€” Unlawful abduction or restraint</li>
        </ul>
      </InfoPopup>
    </div>
    <div class="stats-wrapper relative min-h-[140px] overflow-hidden">
      <!-- Stats Shimmer (shown during loading) -->
      <div id="statsShimmer" class="absolute inset-0 flex gap-4 overflow-x-auto pb-4 transition-opacity duration-300">
        {[...Array(10)].map(() => (
          <div class="flex-shrink-0" style="width: 180px;">
            <LoadingShimmer height="120px" />
          </div>
        ))}
      </div>

      <!-- Actual Stats (hidden initially) -->
      <div class="stats-scroll-container absolute inset-0 opacity-0 transition-opacity duration-300">
        <StatCard value={crimes.length} label="Total Incidents" id="totalIncidents" crimeType="All" />
        <StatCard value={countCrimeType(crimes, 'Murder')} label="Murders" crimeType="Murder" />
        <StatCard value={countCrimeType(crimes, 'Robbery')} label="Robberies" crimeType="Robbery" />
        <StatCard value={countCrimeType(crimes, 'Home Invasion')} label="Home Invasions" crimeType="Home Invasion" />
        <StatCard value={countCrimeType(crimes, 'Theft')} label="Thefts" crimeType="Theft" />
        <StatCard value={countCrimeType(crimes, 'Shooting')} label="Shootings" crimeType="Shooting" />
        <StatCard value={countCrimeType(crimes, 'Assault')} label="Assaults" crimeType="Assault" />
        <StatCard value={countCrimeType(crimes, 'Burglary')} label="Burglaries" crimeType="Burglary" />
        <StatCard value={countCrimeType(crimes, 'Seizures')} label="Seizures" crimeType="Seizures" />
        <StatCard value={countCrimeType(crimes, 'Kidnapping')} label="Kidnappings" crimeType="Kidnapping" />
      </div>

      <!-- Fade gradient + pulsing arrow (right side) -->
      <div id="statsScrollHint" class="absolute right-0 top-0 bottom-4 w-16 bg-gradient-to-l from-white via-white/90 to-transparent pointer-events-none flex items-center justify-end pr-2 opacity-0 transition-opacity duration-300">
        <svg class="w-4 h-4 text-rose-600 animate-pulse" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
        </svg>
      </div>
    </div>

    <!-- Separator -->
        <div class="w-full h-px bg-gradient-to-r from-transparent via-slate-300 to-transparent mb-4"></div>

    <!-- Quick Insights -->
    <div class="mb-6">
      <div class="relative min-h-[280px]">
        <div id="insightsShimmer" class="absolute inset-0 transition-opacity duration-300">
          <LoadingShimmer height="280px" />
        </div>
        <div id="insightsCards" class="absolute inset-0 opacity-0 transition-opacity duration-300">
          <QuickInsightsCard insights={insights} />
        </div>
      </div>
    </div>

    <!-- Leaflet Map -->
    <div class="mb-6">
      <div class="flex items-center gap-2">
        <h2 class="text-h2 font-bold text-slate-500 pt-4 px-4 mb-4">Crime Incidents Map</h2>
        <InfoPopup id="map-info">
          <p class="font-semibold mb-2 text-rose-700">Understanding the Map</p>
          <p class="mb-3">This map shows estimated/reported locations of crimes and is updated daily.</p>
          <p class="font-semibold mb-2 text-rose-700">How to Use:</p>
          <ul class="list-disc list-inside space-y-1">
            <li>Click clusters to zoom in</li>
            <li>Click markers for incident details</li>
            <li>Use two fingers to pan map</li>
          </ul>
        </InfoPopup>
      </div>
      <div class="lg:grid lg:grid-cols-3 lg:gap-4">
        <!-- Map (2/3 on desktop, full width on mobile) -->
        <div id="mapContainer" class="lg:col-span-2 relative h-[450px]">
          <!-- Map Shimmer (shown during loading) -->
          <div id="mapShimmer" class="absolute inset-0 w-full transition-opacity duration-300">
            <LoadingShimmer height="100%" />
          </div>

          <!-- Actual Map (hidden initially) -->
          <div id="leafletMap" class="absolute inset-0 w-full rounded-lg opacity-0 transition-opacity duration-300"></div>

          <!-- Pan instruction overlay (shown on single finger touch) -->
          <div id="mapZoomHintTrinidad" class="absolute inset-0 bg-black/50 flex items-center justify-center opacity-0 pointer-events-none transition-opacity duration-300 z-10">
            <div class="bg-white/85 backdrop-blur-md rounded-lg px-6 py-4 shadow-xl max-w-xs text-center">
              <p class="text-small font-semibold text-slate-600">Use two fingers to move map</p>
              <p class="text-tiny text-slate-600 mt-1">One finger scrolls the page</p>
            </div>
          </div>
        </div>

        <!-- Map Legend (1/3 sidebar on desktop, full width below on mobile) -->
        <div class="mt-4 lg:mt-0 bg-white/85 backdrop-blur-md border border-slate-200 rounded-lg p-4 self-start">
          <h3 class="text-xs font-semibold text-slate-700 mb-3">Legend</h3>
          <div class="grid grid-cols-2 lg:grid-cols-1 gap-x-4 gap-y-2">
            <div class="flex items-center gap-2">
              <span class="w-2.5 h-2.5 rounded-full border border-white shadow-sm shrink-0" style="background:#e11d48"></span>
              <span class="text-xs text-slate-600">Murder</span>
            </div>
            <div class="flex items-center gap-2">
              <span class="w-2.5 h-2.5 rounded-full border border-white shadow-sm shrink-0" style="background:#dc2626"></span>
              <span class="text-xs text-slate-600">Shooting</span>
            </div>
            <div class="flex items-center gap-2">
              <span class="w-2.5 h-2.5 rounded-full border border-white shadow-sm shrink-0" style="background:#f97316"></span>
              <span class="text-xs text-slate-600">Robbery</span>
            </div>
            <div class="flex items-center gap-2">
              <span class="w-2.5 h-2.5 rounded-full border border-white shadow-sm shrink-0" style="background:#9333ea"></span>
              <span class="text-xs text-slate-600">Home Invasion</span>
            </div>
            <div class="flex items-center gap-2">
              <span class="w-2.5 h-2.5 rounded-full border border-white shadow-sm shrink-0" style="background:#06b6d4"></span>
              <span class="text-xs text-slate-600">Theft</span>
            </div>
            <div class="flex items-center gap-2">
              <span class="w-2.5 h-2.5 rounded-full border border-white shadow-sm shrink-0" style="background:#ec4899"></span>
              <span class="text-xs text-slate-600">Kidnapping</span>
            </div>
            <div class="flex items-center gap-2">
              <span class="w-2.5 h-2.5 rounded-full border border-white shadow-sm shrink-0" style="background:#c026d3"></span>
              <span class="text-xs text-slate-600">Sexual Assault</span>
            </div>
            <div class="flex items-center gap-2">
              <span class="w-2.5 h-2.5 rounded-full border border-white shadow-sm shrink-0" style="background:#8b5cf6"></span>
              <span class="text-xs text-slate-600">Assault</span>
            </div>
            <div class="flex items-center gap-2">
              <span class="w-2.5 h-2.5 rounded-full border border-white shadow-sm shrink-0" style="background:#3b82f6"></span>
              <span class="text-xs text-slate-600">Seizures</span>
            </div>
            <div class="flex items-center gap-2">
              <span class="w-2.5 h-2.5 rounded-full border border-white shadow-sm shrink-0" style="background:#eab308"></span>
              <span class="text-xs text-slate-600">Burglary</span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Top Areas -->
    <div class="mb-12">
      <!-- Header with InfoPopup (outside card to avoid backdrop-blur containment) -->
      <div class="flex items-center gap-2 mb-4 px-4">
        <h3 class="text-h3 font-bold text-slate-700">Top Areas</h3>
        <a href={routes.trinidad.areas} class="ml-auto text-xs text-rose-600 hover:text-rose-700 active:text-rose-800 font-medium transition">
          View all
          <svg class="w-3 h-3 inline-block ml-0.5 -mt-px" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
          </svg>
        </a>
        <InfoPopup id="top-areas-risk-info">
          <p class="font-semibold mb-2 text-rose-700">Understanding Risk Assessment</p>
          <p class="mb-3">Each area's risk level is calculated based on crime severity and victim impact.</p>
          <p class="font-semibold mb-2 text-rose-700">How It Works:</p>
          <ul class="list-disc list-inside space-y-1 mb-3">
            <li>Each crime type has a severity weight (Murder=10, Theft=2, etc.)</li>
            <li>Victim counts multiply risk for serious crimes</li>
            <li>Area risk = sum of all crime risk scores</li>
            <li>Bar shows percentage relative to highest-risk area</li>
          </ul>
          <p class="font-semibold mb-2 text-rose-700">Color Guide:</p>
          <ul class="list-disc list-inside space-y-1">
            <li><span class="text-green-600 font-medium">Green</span>: Low risk (0-33%)</li>
            <li><span class="text-yellow-600 font-medium">Yellow</span>: Medium risk (34-66%)</li>
            <li><span class="text-rose-600 font-medium">Red</span>: High risk (67-100%)</li>
          </ul>
        </InfoPopup>
      </div>

      <div class="relative">
        <div id="topRegionsShimmer" class="absolute inset-0 z-10 transition-opacity duration-300">
          <LoadingShimmer height="100%" />
        </div>
        <div id="topRegionsCard" class="opacity-0 transition-opacity duration-300">
          <TopRegionsCard crimes={crimes} />
        </div>
      </div>
    </div>

    <!-- Info Cards -->
    <DashboardInfoCards />

    <!-- Related Resources -->
    <div class="mt-8">
      <h2 class="text-lg font-semibold text-slate-700 mb-4">Related Resources</h2>
      <div class="grid sm:grid-cols-2 gap-3">
        <a href={routes.trinidad.statistics} class="block bg-white rounded-lg border border-slate-200 p-4 hover:border-rose-300 hover:shadow-sm transition">
          <h3 class="font-semibold text-slate-800 text-sm">Crime Statistics & Rate</h3>
          <p class="text-xs text-slate-500 mt-1">Comprehensive statistics with year-over-year analysis and crime rate calculations</p>
        </a>
        <a href={routes.trinidad.murderCount} class="block bg-rose-50 rounded-lg border border-rose-200 p-4 hover:border-rose-400 hover:shadow-md transition">
          <div class="flex items-center gap-1.5 mb-1">
            <svg class="w-4 h-4 text-rose-500" fill="currentColor" viewBox="0 0 24 24"><path d="M12 23c-3.6 0-8-3.13-8-8.46C4 9.5 9.04 3.18 11.14.97a1.15 1.15 0 011.72 0C15 3.18 20 9.5 20 14.54 20 19.87 15.6 23 12 23zm0-19.73C9.64 6.1 6 11.47 6 14.54 6 18.62 9.07 21 12 21s6-2.38 6-6.46c0-3.07-3.64-8.44-6-11.27z"/><path d="M12 19a3.5 3.5 0 01-3.5-3.5c0-1.56 1.84-3.88 3.08-5.12a.58.58 0 01.84 0c1.24 1.24 3.08 3.56 3.08 5.12A3.5 3.5 0 0112 19z"/></svg>
            <h3 class="font-semibold text-rose-700 text-sm">Murder Count {currentYear}</h3>
          </div>
          <p class="text-xs text-rose-600/70">Live murder count with year-over-year comparison</p>
        </a>
      </div>
    </div>
  </div>

  <!-- Initialize Dashboard Data -->
  <script>
    import { initializeDashboardData } from '../../scripts/dashboardDataLoader';

    // Wait for DOM and load crimes data
    window.addEventListener('DOMContentLoaded', initializeDashboardData);
  </script>

  <!-- Leaflet Map Initialization -->
  <script>
    import { initializeLeafletMap } from '../../scripts/leafletMap';

    // Track when map shimmer started
    const mapShimmerStartTime = Date.now();

    // Wait for crimes data to be available
    function waitForMapData() {
      if (!window.__crimesData) {
        setTimeout(waitForMapData, 100);
        return;
      }

      // Get current year
      const availableYears = [...new Set(window.__crimesData.map((c: any) => c.year))].sort((a: number, b: number) => b - a);
      const currentYear = availableYears[0];
      const currentYearCrimes = window.__crimesData.filter((c: any) => c.year === currentYear);

      initializeLeafletMap('leafletMap', currentYearCrimes, {
        center: [10.634963, -61.197207],
        zoom: 8,
        country: 'Trinidad',
        crimeDetailPath: '/trinidad/crime/',
        onMapReady: async () => {
          // Hide map shimmer with minimum display time (500ms)
          const elapsed = Date.now() - mapShimmerStartTime;
          const remaining = Math.max(0, 500 - elapsed);

          if (remaining > 0) {
            await new Promise(resolve => setTimeout(resolve, remaining));
          }

          const mapShimmer = document.getElementById('mapShimmer');
          const leafletMap = document.getElementById('leafletMap');

          if (mapShimmer) mapShimmer.style.display = 'none';
          if (leafletMap) leafletMap.style.opacity = '1';

          console.log('âœ… Map shimmer hidden, map visible');
        }
      });
    }

    waitForMapData();
  </script>

  <!-- Year Filtering Script -->
  <script>
    import { initializeYearFilter } from '../../scripts/yearFilter';
    import { updateLeafletMap } from '../../scripts/leafletMap';
    import { updateStatsCards, updateQuickInsights, updateTopRegions } from '../../scripts/dashboardUpdates';
    import { initializeStatCardFiltering, initializeTraySync } from '../../scripts/statCardFiltering';

    console.log('ðŸš€ Year filter script starting...');

    // Wait for crimes data to be available
    function waitForCrimesData() {
      if (!window.__crimesData) {
        setTimeout(waitForCrimesData, 100);
        return;
      }

      // Initialize year filter with callbacks
      initializeYearFilter(window.__crimesData, {
        updateStatsCards: (crimes) => {
          // Show shimmer before update
          const statsShimmer = document.getElementById('statsShimmer');
          const statsContainer = document.querySelector('.stats-scroll-container');

          if (statsShimmer) { statsShimmer.style.opacity = '1'; statsShimmer.style.pointerEvents = ''; }
          if (statsContainer) statsContainer.style.opacity = '0';

          // Update after short delay
          setTimeout(async () => {
            const updateStart = Date.now();
            updateStatsCards(crimes, window.__crimesData);

            // Hide shimmer with minimum time
            await window.hideShimmerWithMinTime(statsShimmer, statsContainer, updateStart);
          }, 100);
        },
        updateQuickInsights: (crimes) => {
          // Show shimmer before update
          const insightsShimmer = document.getElementById('insightsShimmer');
          const insightsCards = document.getElementById('insightsCards');

          if (insightsShimmer) { insightsShimmer.style.opacity = '1'; insightsShimmer.style.pointerEvents = ''; }
          if (insightsCards) insightsCards.style.opacity = '0';

          // Update after short delay
          setTimeout(async () => {
            const updateStart = Date.now();
            updateQuickInsights(crimes);

            // Hide shimmer with minimum time
            await window.hideShimmerWithMinTime(insightsShimmer, insightsCards, updateStart);
          }, 100);
        },
        updateTopRegions: (crimes) => {
          // Show shimmer before update (absolute overlay - opacity transition)
          const topRegionsShimmer = document.getElementById('topRegionsShimmer');
          const topRegionsCard = document.getElementById('topRegionsCard');

          if (topRegionsShimmer) { topRegionsShimmer.style.opacity = '1'; topRegionsShimmer.style.pointerEvents = ''; }
          if (topRegionsCard) topRegionsCard.style.opacity = '0';

          // Update after short delay
          setTimeout(async () => {
            const updateStart = Date.now();
            updateTopRegions(crimes);

            // Hide shimmer with minimum time
            await window.hideShimmerWithMinTime(topRegionsShimmer, topRegionsCard, updateStart);
          }, 100);
        },
        updateLeafletMap: (crimes) => {
          // Show shimmer before update
          const mapShimmer = document.getElementById('mapShimmer');
          const leafletMap = document.getElementById('leafletMap');

          if (mapShimmer) { mapShimmer.style.opacity = '1'; mapShimmer.style.pointerEvents = ''; }
          if (leafletMap) leafletMap.style.opacity = '0';

          // Update after short delay
          setTimeout(async () => {
            const updateStart = Date.now();
            updateLeafletMap(crimes, '/trinidad/crime/');

            // Hide shimmer with minimum time
            await window.hideShimmerWithMinTime(mapShimmer, leafletMap, updateStart);
          }, 100);
        },
        updateSubtitleYear: (selectedValue) => {
          const dashboardYear = document.getElementById('dashboardYear');
          if (!dashboardYear) return;

          // Update year display based on selection
          if (selectedValue === 'all') {
            dashboardYear.textContent = '(All Years)';
          } else {
            dashboardYear.textContent = `for ${selectedValue}`;
          }

          // Update data freshness indicator
          const freshness = document.getElementById('dataFreshness');
          if (freshness && window.__crimesData) {
            const filtered = selectedValue === 'all'
              ? window.__crimesData
              : window.__crimesData.filter((c: any) => {
                  const y = new Date(c.date).getFullYear();
                  return selectedValue.split(',').map(Number).includes(y);
                });
            if (filtered.length > 0) {
              const newest = filtered.reduce((a: any, b: any) => new Date(a.date) > new Date(b.date) ? a : b);
              const d = new Date(newest.date);
              freshness.innerHTML = `<svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/></svg> Data as of ${d.toLocaleDateString('en-GB', { day: 'numeric', month: 'short', year: 'numeric' })}`;
            }
          }
        }
      });
    }

    // Start waiting for crimes data
    waitForCrimesData();

    // Initialize stat card filtering after DOM is ready
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', () => {
        initializeStatCardFiltering({
          updateQuickInsights,
          updateTopRegions,
          updateLeafletMap
        });
      });
    } else {
      initializeStatCardFiltering({
        updateQuickInsights,
        updateTopRegions,
        updateLeafletMap
      });
    }
  </script>

  <!-- Filters Tray Component -->
  <FiltersTray showYearFilter={true} showCrimeTypeFilter={true} />

  <!-- Sync Stat Cards with Tray Checkboxes -->
  <script>
    import { initializeTraySync } from '../../scripts/statCardFiltering';

    // Initialize after DOM is ready
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', initializeTraySync);
    } else {
      initializeTraySync();
    }
  </script>

  <!-- Mouse Wheel Horizontal Scroll for Stats Cards -->
  <script>
    import { initializeStatsScroll } from '../../scripts/statsScroll';
    initializeStatsScroll();
  </script>
</Layout>
