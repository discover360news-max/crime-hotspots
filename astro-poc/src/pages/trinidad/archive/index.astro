---
/**
 * Archive Index Page
 * Lists all available monthly archives
 * URL: /trinidad/archive
 */

// Keep archive index static (pre-rendered at build time)
export const prerender = true;

import Layout from '../../../layouts/Layout.astro';
import Breadcrumbs from '../../../components/Breadcrumbs.astro';
import SiteNotificationBanner from '../../../components/SiteNotificationBanner.astro';
import { getTrinidadCrimes } from '../../../lib/crimeData';
import { dataUpdateNotice } from '../../../config/siteNotifications';
import { getCountryName } from '../../../data/countries';

const crimes = await getTrinidadCrimes();

// Group by year and month
const archiveMap = new Map<string, { year: number; month: number; count: number }>();

crimes.forEach(crime => {
  const key = `${crime.year}-${String(crime.month).padStart(2, '0')}`;
  if (!archiveMap.has(key)) {
    archiveMap.set(key, { year: crime.year, month: crime.month, count: 0 });
  }
  archiveMap.get(key)!.count++;
});

// Sort by year/month descending (newest first)
const archives = Array.from(archiveMap.values()).sort((a, b) => {
  if (a.year !== b.year) return b.year - a.year;
  return b.month - a.month;
});

const title = "Trinidad & Tobago Crime Archives | Crime Hotspots";
const description = "Browse crime statistics archives for Trinidad & Tobago by month. View trends, statistics, and detailed reports.";
---

<Layout title={title} description={description}>
  <div class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8 py-4">
    <!-- Breadcrumbs -->
    <Breadcrumbs items={[
      { label: 'Home', href: '/' },
      { label: getCountryName('tt'), href: '/trinidad/dashboard' },
      { label: 'Archive' }
    ]} />

    <!-- Navigation Buttons -->
    <div class="flex gap-2 mb-6">
      <a
        href="/trinidad/dashboard"
        class="px-4 py-1.5 min-h-[22px] flex items-center justify-center border border-rose-600 text-rose-600 rounded-lg hover:bg-rose-50 active:bg-rose-100 transition font-medium text-xs whitespace-nowrap"
      >
        Dashboard
      </a>
      <a
        href="/trinidad/headlines"
        class="px-4 py-1.5 min-h-[22px] flex items-center justify-center border border-rose-600 text-rose-600 rounded-lg hover:bg-rose-50 active:bg-rose-100 transition font-medium text-xs whitespace-nowrap"
      >
        Headlines
      </a>
    </div>

    <!-- Page Header -->
    <div class="text-center mb-8">
      <h1 class="text-display text-slate-700 mb-2">Crime Archives</h1>
      <p class="text-display font-bold text-rose-600">Trinidad & Tobago</p>
      <p class="text-xs text-slate-500 mt-2">
        Browse {crimes.length} crime incidents organized by month
      </p>
    </div>

    <!-- Site Notification Banner -->
    <div class="max-w-4xl mx-auto">
      <SiteNotificationBanner notification={dataUpdateNotice} />
    </div>

    <!-- Archive List -->
    <div class="grid grid-cols-2 md:grid-cols-2 lg:grid-cols-3 gap-4">
      {archives.map(archive => {
        const monthName = new Date(archive.year, archive.month - 1).toLocaleDateString('en-US', { month: 'long' });
        return (
          <a
            href={`/trinidad/archive/${archive.year}/${String(archive.month).padStart(2, '0')}`}
            class="block bg-white/70 rounded-lg shadow-sm border border-slate-200 p-6 hover:border-rose-600 hover:shadow-md active:shadow-lg transition group"
          >
            <div class="flex items-start justify-between">
              <div>
                <h2 class="text-h3 font-bold text-slate-500 group-hover:text-rose-600 transition">
                  {monthName} <br>{archive.year}</br>
                </h2>
                <p class="text-tiny text-rose-600 mt-1">
                  {archive.count} {archive.count === 1 ? 'crime' : 'crimes'}
                </p>
              </div>
              <svg class="w-5 h-5 text-rose-600 group-hover:text-rose-600 transition" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
              </svg>
            </div>

            <div class="mt-4 flex items-center text-xs text-slate-500">
              View full report
            </div>
          </a>
        );
      })}
    </div>

    {archives.length === 0 && (
      <div class="text-center py-12">
        <p class="text-body text-slate-600">No archives available yet.</p>
      </div>
    )}
  </div>
</Layout>
