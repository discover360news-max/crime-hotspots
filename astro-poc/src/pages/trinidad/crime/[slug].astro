---
/**
 * Individual Crime Page
 * Generates a unique SEO-optimized page for EACH crime
 * URL: /trinidad/crime/murder-port-of-spain-2025-12-10
 */

import Layout from '../../../layouts/Layout.astro';
import { getTrinidadCrimes, type Crime } from '../../../lib/crimeData';
import Breadcrumbs from '../../../components/Breadcrumbs.astro';
import ReportIssueModal from '../../../components/ReportIssueModal.astro';

// This tells Astro to generate a static page for each crime
export async function getStaticPaths() {
  const crimes = await getTrinidadCrimes();

  return crimes.map((crime) => ({
    params: { slug: crime.slug },
    props: { crime },
  }));
}

interface Props {
  crime: Crime;
}

const { crime } = Astro.props;

// SEO Meta Tags
const title = `${crime.headline} | Crime Hotspots Trinidad`;
const description = crime.summary || `${crime.crimeType} in ${crime.area} on ${crime.date}. View details, location, and related crimes.`;
---

<Layout title={title} description={description}>
  <!-- Schema.org NewsArticle Markup -->
  <script type="application/ld+json" slot="head">
    {
      JSON.stringify({
        "@context": "https://schema.org",
        "@type": "NewsArticle",
        "headline": crime.headline,
        "datePublished": crime.dateObj.toISOString(),
        "articleSection": crime.crimeType,
        "locationCreated": {
          "@type": "Place",
          "name": crime.area,
          "address": {
            "@type": "PostalAddress",
            "addressRegion": crime.region,
            "addressCountry": "TT"
          }
        },
        "description": crime.summary,
        "url": `https://crimehotspots.com/trinidad/crime/${crime.slug}`,
        "publisher": {
          "@type": "Organization",
          "name": "Crime Hotspots",
          "url": "https://crimehotspots.com"
        }
      })
    }
  </script>

  <!-- Breadcrumb Schema.org -->
  <script type="application/ld+json" slot="head">
    {
      JSON.stringify({
        "@context": "https://schema.org",
        "@type": "BreadcrumbList",
        "itemListElement": [
          {
            "@type": "ListItem",
            "position": 1,
            "name": "Home",
            "item": "https://crimehotspots.com/"
          },
          {
            "@type": "ListItem",
            "position": 2,
            "name": "Trinidad Archives",
            "item": "https://crimehotspots.com/trinidad/archive"
          },
          {
            "@type": "ListItem",
            "position": 3,
            "name": `${crime.year}-${String(crime.month).padStart(2, '0')}`,
            "item": `https://crimehotspots.com/trinidad/archive/${crime.year}/${String(crime.month).padStart(2, '0')}`
          },
          {
            "@type": "ListItem",
            "position": 4,
            "name": crime.headline,
            "item": `https://crimehotspots.com/trinidad/crime/${crime.slug}`
          }
        ]
      })
    }
  </script>

  <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <!-- Breadcrumbs -->
    <Breadcrumbs items={[
      { label: 'Home', href: '/' },
      { label: 'TnT Archive', href: '/trinidad/archive' },
      { label: crime.year }
    ]} />

    <article class="bg-white/50 rounded-lg shadow-sm border border-slate-200 p-6 sm:p-8">
      <!-- Crime Details -->
      <header class="mb-6">
        <h1 class="text-h1 font-bold text-slate-700 mb-4">{crime.headline}</h1>

        <div class="flex flex-wrap items-center gap-3 text-xs">
          <time datetime={crime.dateObj.toISOString()} class="text-slate-500">
            {crime.dateObj.toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' })}
          </time>
          <span class="px-3 py-1 min-h-[22px] flex items-center justify-center rounded-full bg-rose-600 text-white font-medium" data-pagefind-ignore>
            {crime.crimeType}
          </span>
          <span class="text-slate-500" data-pagefind-ignore>
            {crime.street ? `${crime.street}, ` : ''}{crime.area}
          </span>
        </div>
      </header>

      {crime.summary && (
        <div class="mb-6">
          <p class="text-body text-slate-700 leading-relaxed">{crime.summary}</p>
        </div>
      )}

      <dl class="grid grid-cols-1 sm:grid-cols-2 gap-4 mb-6 p-4 bg-slate-50 rounded-lg" data-pagefind-ignore>
        <dt class="text-xs font-semibold text-slate-500">Region:</dt>
        <dd class="text-xs text-slate-700">{crime.region}</dd>

        {crime.source && (
          <>
            <dt class="text-xs font-semibold text-slate-500">Source:</dt>
            <dd class="text-xs text-slate-700">
              {crime.url ? (
                <a
                  href={crime.url}
                  target="_blank"
                  rel="noopener noreferrer"
                  class="text-rose-600 hover:text-rose-700 border-b border-dotted border-rose-600 hover:border-rose-700"
                >
                  {crime.source}
                </a>
              ) : (
                crime.source
              )}
            </dd>
          </>
        )}
      </dl>

      <!-- Related Crimes -->
      <aside class="mt-8 p-6 bg-slate-100 rounded-lg border border-slate-200" data-pagefind-ignore>
        <h2 class="text-h3 font-bold text-slate-700 mb-4">Related Crimes</h2>
        <ul class="space-y-2">
          <li>
            <a
              href={`/trinidad/archive/${crime.year}/${String(crime.month).padStart(2, '0')}`}
              class="text-xs text-rose-600 hover:text-rose-700 hover:underline"
            >
              → All crimes in {crime.dateObj.toLocaleDateString('en-US', { month: 'long', year: 'numeric' })}
            </a>
          </li>
          <li>
            <a
              href="/trinidad/dashboard"
              class="text-xs text-rose-600 hover:text-rose-700 hover:underline"
            >
              → View {crime.region} on interactive map
            </a>
          </li>
          <li>
            <a
              href="/trinidad/headlines"
              class="text-xs text-rose-600 hover:text-rose-700 hover:underline"
            >
              → Browse recent {crime.crimeType} incidents
            </a>
          </li>
        </ul>
      </aside>

      <!-- Report Issue Section -->
      <div class="mt-6 p-4 bg-white/50 rounded-lg border border-slate-200 flex items-center justify-between" data-pagefind-ignore>
        <div>
          <p class="text-sm font-semibold text-slate-700">Found incorrect information?</p>
          <p class="text-xs text-slate-500 mt-1">Help us keep our data accurate by reporting issues.</p>
        </div>
        <ReportIssueModal
          crimeSlug={crime.slug}
          crimeHeadline={crime.headline}
          crimeDate={crime.date}
          crimeType={crime.crimeType}
          crimeArea={crime.area}
          crimeRegion={crime.region}
          crimeStreet={crime.street}
          crimeSummary={crime.summary}
          crimeSource={crime.source}
          crimeUrl={crime.url}
        />
      </div>
    </article>
  </div>
</Layout>
