---
/**
 * Individual Crime Page
 * Generates a unique SEO-optimized page for EACH crime
 * URL: /trinidad/crime/murder-port-of-spain-2025-12-10
 */

import Layout from '../../../layouts/Layout.astro';
import { getTrinidadCrimes, type Crime } from '../../../lib/crimeData';

// This tells Astro to generate a static page for each crime
export async function getStaticPaths() {
  const crimes = await getTrinidadCrimes();

  return crimes.map((crime) => ({
    params: { slug: crime.slug },
    props: { crime },
  }));
}

interface Props {
  crime: Crime;
}

const { crime } = Astro.props;

// SEO Meta Tags
const title = `${crime.headline} | Crime Hotspots Trinidad`;
const description = crime.summary || `${crime.crimeType} in ${crime.area} on ${crime.date}. View details, location, and related crimes.`;
---

<Layout title={title} description={description}>
  <!-- Schema.org NewsArticle Markup -->
  <script type="application/ld+json" slot="head">
    {
      JSON.stringify({
        "@context": "https://schema.org",
        "@type": "NewsArticle",
        "headline": crime.headline,
        "datePublished": crime.dateObj.toISOString(),
        "articleSection": crime.crimeType,
        "locationCreated": {
          "@type": "Place",
          "name": crime.area,
          "address": {
            "@type": "PostalAddress",
            "addressRegion": crime.region,
            "addressCountry": "TT"
          }
        },
        "description": crime.summary,
        "url": `https://crimehotspots.com/trinidad/crime/${crime.slug}`,
        "publisher": {
          "@type": "Organization",
          "name": "Crime Hotspots",
          "url": "https://crimehotspots.com"
        }
      })
    }
  </script>

  <!-- Breadcrumb Schema.org -->
  <script type="application/ld+json" slot="head">
    {
      JSON.stringify({
        "@context": "https://schema.org",
        "@type": "BreadcrumbList",
        "itemListElement": [
          {
            "@type": "ListItem",
            "position": 1,
            "name": "Home",
            "item": "https://crimehotspots.com/"
          },
          {
            "@type": "ListItem",
            "position": 2,
            "name": "Trinidad Archives",
            "item": "https://crimehotspots.com/trinidad/archive"
          },
          {
            "@type": "ListItem",
            "position": 3,
            "name": `${crime.year}-${String(crime.month).padStart(2, '0')}`,
            "item": `https://crimehotspots.com/trinidad/archive/${crime.year}/${String(crime.month).padStart(2, '0')}`
          },
          {
            "@type": "ListItem",
            "position": 4,
            "name": crime.headline,
            "item": `https://crimehotspots.com/trinidad/crime/${crime.slug}`
          }
        ]
      })
    }
  </script>

  <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <!-- Breadcrumbs -->
    <nav aria-label="Breadcrumb" class="mb-6">
      <ol class="flex items-center gap-2 text-xs text-slate-500">
        <li><a href="/" class="hover:text-rose-600 transition">Home</a></li>
        <li>/</li>
        <li><a href="/trinidad/archive" class="hover:text-rose-600 transition">Trinidad</a></li>
        <li>/</li>
        <li><a href={`/trinidad/archive/${crime.year}/${String(crime.month).padStart(2, '0')}`} class="hover:text-rose-600 transition">
          {crime.year}-{String(crime.month).padStart(2, '0')}
        </a></li>
        <li>/</li>
        <li class="text-rose-600 font-medium truncate max-w-xs">{crime.headline.substring(0, 40)}{crime.headline.length > 40 ? '...' : ''}</li>
      </ol>
    </nav>

    <article class="bg-white/50 rounded-lg shadow-sm border border-slate-200 p-6 sm:p-8">
      <!-- Crime Details -->
      <header class="mb-6">
        <h1 class="text-h1 font-bold text-slate-700 mb-4">{crime.headline}</h1>

        <div class="flex flex-wrap items-center gap-3 text-xs">
          <time datetime={crime.dateObj.toISOString()} class="text-slate-400">
            {crime.dateObj.toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' })}
          </time>
          <span class="px-3 py-1 min-h-[22px] flex items-center justify-center rounded-full bg-rose-600 text-white font-medium">
            {crime.crimeType}
          </span>
          <span class="text-slate-400">
            {crime.area}, {crime.region}
          </span>
        </div>
      </header>

      {crime.summary && (
        <div class="mb-6">
          <p class="text-body text-slate-700 leading-relaxed">{crime.summary}</p>
        </div>
      )}

      <dl class="grid grid-cols-1 sm:grid-cols-2 gap-4 mb-6 p-4 bg-slate-50 rounded-lg">
        {crime.street && (
          <>
            <dt class="text-xs font-semibold text-slate-400">Street/Location:</dt>
            <dd class="text-xs text-slate-700">{crime.street}</dd>
          </>
        )}

        <dt class="text-xs font-semibold text-slate-400">Area:</dt>
        <dd class="text-xs text-slate-700">{crime.area}</dd>

        <dt class="text-xs font-semibold text-slate-400">Region:</dt>
        <dd class="text-xs text-slate-700">{crime.region}</dd>

        {crime.source && (
          <>
            <dt class="text-xs font-semibold text-slate-400">Source:</dt>
            <dd class="text-xs text-slate-700">{crime.source}</dd>
          </>
        )}
      </dl>

      {crime.url && (
        <div class="mb-6">
          <a
            href={crime.url}
            target="_blank"
            rel="noopener noreferrer"
            class="inline-flex items-center gap-2 px-4 py-1.5 min-h-[22px] rounded-lg bg-rose-600 text-white hover:bg-rose-700 transition text-xs font-medium"
          >
            Read original article
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14" />
            </svg>
          </a>
        </div>
      )}

      <!-- Related Crimes -->
      <aside class="mt-8 p-6 bg-slate-100 rounded-lg border border-slate-200">
        <h2 class="text-h3 font-bold text-slate-700 mb-4">Related Crimes</h2>
        <ul class="space-y-2">
          <li>
            <a
              href={`/trinidad/archive/${crime.year}/${String(crime.month).padStart(2, '0')}`}
              class="text-xs text-rose-600 hover:text-rose-700 hover:underline"
            >
              → All crimes in {crime.year} - {String(crime.month).padStart(2, '0')}
            </a>
          </li>
          <li>
            <a
              href={`/trinidad/archive`}
              class="text-xs text-rose-600 hover:text-rose-700 hover:underline"
            >
              → More crimes in {crime.region}
            </a>
          </li>
          <li>
            <a
              href={`/trinidad/archive`}
              class="text-xs text-rose-600 hover:text-rose-700 hover:underline"
            >
              → More {crime.crimeType} incidents
            </a>
          </li>
        </ul>
      </aside>
    </article>
  </div>
</Layout>
