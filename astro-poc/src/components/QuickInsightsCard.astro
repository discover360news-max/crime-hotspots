---
/**
 * QuickInsightsCard Component
 * Displays key crime statistics and insights
 * Shows daily average, peak day, busiest month, concentration, and safety indicators
 */

interface Props {
  insights: {
    avgPerDay: string;
    victimsPerDay: number;
    mostDangerousDay: string;
    busiestMonth: string;
    top3Percentage: string;
    mostDangerousRegion: string;
    mostDangerousRegionCount: number;
    safestRegion: string;
    safestRegionCount: number;
  };
  busiestLabel?: string; // Optional custom label for the busiest field
}

import { generateNameSlug } from '../lib/crimeData';
import { buildRoute } from '../config/routes';

const { insights, busiestLabel = 'Busiest Month' } = Astro.props;

const dangerousSlug = generateNameSlug(insights.mostDangerousRegion);
const safestSlug = generateNameSlug(insights.safestRegion);
---

<div id="quickInsightsCard" class="bg-white/85 dark:bg-[hsl(0_0%_8%)]/85 backdrop-blur-md rounded-lg p-4 shadow-md border border-slate-100 dark:border-[hsl(0_0%_15%)]">
  <!-- 2x2 Grid Layout (Always 2 columns, even on mobile) -->
  <div class="grid grid-cols-2 gap-3 md:gap-4 mb-4">
    <!-- Daily Average -->
    <div class="flex items-start gap-2">
      <svg class="w-4 h-4 md:w-5 md:h-5 text-slate-400 dark:text-[hsl(0_0%_50%)] flex-shrink-0 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z" />
      </svg>
      <div class="flex-1 min-w-0">
        <div class="text-xs text-slate-500 dark:text-[hsl(0_0%_55%)] mb-1">Daily Avg</div>
        <div id="avgPerDay" class="text-sm md:text-lg font-bold text-slate-700 dark:text-[hsl(0_0%_90%)] break-words">{insights.avgPerDay} crimes/day</div>
        <div id="victimsPerDay" class="text-xs text-slate-500 dark:text-[hsl(0_0%_55%)] mt-0.5">{insights.victimsPerDay} victims/day</div>
      </div>
    </div>

    <!-- Most Dangerous Day -->
    <div class="flex items-start gap-2">
      <svg class="w-4 h-4 md:w-5 md:h-5 text-slate-400 dark:text-[hsl(0_0%_50%)] flex-shrink-0 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />
      </svg>
      <div class="flex-1 min-w-0">
        <div class="text-xs text-slate-500 dark:text-[hsl(0_0%_55%)] mb-1">Peak Day</div>
        <div id="mostDangerousDay" class="text-sm md:text-lg font-bold text-slate-700 dark:text-[hsl(0_0%_90%)] break-words">{insights.mostDangerousDay}s</div>
      </div>
    </div>

    <!-- Busiest Month / Deadliest Day -->
    <div class="flex items-start gap-2">
      <svg class="w-4 h-4 md:w-5 md:h-5 text-slate-400 dark:text-[hsl(0_0%_50%)] flex-shrink-0 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1" d="M16 8v8m-4-5v5m-4-2v2m-2 4h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z" />
      </svg>
      <div class="flex-1 min-w-0">
        <div class="text-xs text-slate-500 dark:text-[hsl(0_0%_55%)] mb-1">{busiestLabel}</div>
        <div id="busiestMonth" class="text-sm md:text-lg font-bold text-slate-700 dark:text-[hsl(0_0%_90%)] break-words">{insights.busiestMonth}</div>
      </div>
    </div>

    <!-- Crime Concentration -->
    <div class="flex items-start gap-2">
      <svg class="w-4 h-4 md:w-5 md:h-5 text-slate-400 dark:text-[hsl(0_0%_50%)] flex-shrink-0 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z" />
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z" />
      </svg>
      <div class="flex-1 min-w-0">
        <div class="text-xs text-slate-500 dark:text-[hsl(0_0%_55%)] mb-1">Concentration of Crimes</div>
        <div id="top3Percentage" class="text-sm md:text-lg font-bold text-slate-700 dark:text-[hsl(0_0%_90%)] break-words">Top 3 Areas: {insights.top3Percentage}%</div>
      </div>
    </div>
  </div>

  <!-- Safety Indicators (Full Width) -->
  <div class="pt-4 border-t border-slate-200 dark:border-[hsl(0_0%_18%)]">
    <div class="grid grid-cols-2 gap-4">
      <a href={buildRoute.area(dangerousSlug)} class="flex items-start gap-2 hover:bg-rose-50 dark:hover:bg-rose-950/60 active:bg-rose-50 dark:active:bg-rose-950/60 rounded-lg p-2 -m-2 transition group/area">
        <svg class="w-4 h-4 md:w-5 md:h-5 text-slate-400 dark:text-[hsl(0_0%_50%)] flex-shrink-0 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1" d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6" />
        </svg>
        <div class="flex-1 min-w-0">
          <div class="text-xs text-slate-500 dark:text-[hsl(0_0%_55%)] mb-1">Highest Crimes</div>
          <div id="mostDangerousRegion" class="text-sm font-semibold text-rose-600 underline decoration-dotted decoration-rose-300 underline-offset-2">{insights.mostDangerousRegion}</div>
          <div id="mostDangerousRegionCount" class="text-xs text-slate-500 dark:text-[hsl(0_0%_55%)]">{insights.mostDangerousRegionCount} incidents</div>
        </div>
      </a>
      <a href={buildRoute.area(safestSlug)} class="flex items-start gap-2 hover:bg-emerald-50 dark:hover:bg-emerald-950/60 active:bg-emerald-50 dark:active:bg-emerald-950/60 rounded-lg p-2 -m-2 transition group/area">
        <svg class="w-4 h-4 md:w-5 md:h-5 text-slate-400 dark:text-[hsl(0_0%_50%)] flex-shrink-0 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1" d="M13 17h8m0 0V9m0 8l-8-8-4 4-6-6" />
        </svg>
        <div class="flex-1 min-w-0">
          <div class="text-xs text-slate-500 dark:text-[hsl(0_0%_55%)] mb-1">Lowest Crimes</div>
          <div id="safestRegion" class="text-sm font-semibold text-emerald-600 underline decoration-dotted decoration-emerald-300 underline-offset-2">{insights.safestRegion}</div>
          <div id="safestRegionCount" class="text-xs text-slate-500 dark:text-[hsl(0_0%_55%)]">{insights.safestRegionCount} incidents</div>
        </div>
      </a>
    </div>
  </div>
</div>
