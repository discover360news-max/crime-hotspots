---
/**
 * StatCards Component
 * Grid of statistics cards with year-over-year comparison
 * Supports optional subtitle override (e.g., "out of 10") instead of YoY comparison
 *
 * Usage:
 * <StatCards stats={[
 *   { label: "Murders", current: 50, previous: 45, yoyChange: 11.1, direction: "up" },
 *   { label: "Risk Level", current: 7.2, subtitle: "out of 10" },
 *   ...
 * ]} />
 */

interface StatCard {
  label: string;
  current: number;
  previous?: number;
  yoyChange?: number;
  direction?: 'up' | 'down' | 'flat';
  subtitle?: string;
  highlight?: boolean; // true = render count in rose-600 (e.g. murder stats)
}

interface Props {
  stats: StatCard[];
}

const { stats } = Astro.props;

const currentYear = new Date().getFullYear();
const previousYear = currentYear - 1;

function formatPercentChange(change: number): string {
  const formatted = Math.abs(change).toFixed(1);
  return change >= 0 ? `+${formatted}%` : `-${formatted}%`;
}
---

<div class="grid grid-cols-2 sm:grid-cols-4 gap-4">
  {stats.map((stat) => (
    <div class="bg-white/85 dark:bg-[hsl(0_0%_8%)]/85 rounded-lg border border-slate-200 dark:border-[hsl(0_0%_18%)] p-4 shadow-sm">
      <div class="text-caption text-slate-500 dark:text-[hsl(0_0%_60%)] font-bold">{stat.label}</div>
      <div class={`text-2xl sm:text-3xl font-bold mt-1 ${stat.highlight ? 'text-rose-600 dark:text-rose-400' : 'text-slate-800 dark:text-[hsl(0_0%_95%)]'}`}>{stat.current}</div>
      {stat.subtitle ? (
        <div class="text-caption mt-1 text-slate-400 dark:text-[hsl(0_0%_50%)]">{stat.subtitle}</div>
      ) : stat.direction && stat.yoyChange !== undefined ? (
        <div class={`text-caption mt-1 ${
          stat.direction === 'down' ? 'text-emerald-600 dark:text-emerald-400' :
          stat.direction === 'up' ? 'text-rose-600' :
          'text-slate-400 dark:text-[hsl(0_0%_50%)]'
        }`}>
          {stat.direction === 'down' ? '↓' : stat.direction === 'up' ? '↑' : '→'}
          {formatPercentChange(stat.yoyChange)} vs {previousYear}
        </div>
      ) : null}
    </div>
  ))}
</div>
