---
/**
 * Areas Selection Modal
 * Fallback island selector when user is not on a country-specific page
 * Opens from header nav when current path doesn't match a known country
 */
import { COUNTRIES } from '../data/countries';
import { routes } from '../config/routes';
---

<!-- Modal Overlay -->
<div
  id="areasModal"
  class="fixed inset-0 bg-black/50 backdrop-blur-sm z-50 opacity-0 invisible transition-all duration-300 flex items-center justify-center p-4"
  data-pagefind-ignore
>
  <!-- Modal Content -->
  <div
    id="areasModalContent"
    class="bg-white/90 backdrop-blur-xl rounded-2xl shadow-2xl max-w-md w-full opacity-0 scale-95 transition-all duration-300"
  >
    <!-- Header -->
    <div class="sticky top-0 bg-white/80 backdrop-blur-md border-b border-slate-200 px-6 py-4 flex items-center justify-between rounded-t-2xl">
      <h2 class="text-h2 font-bold text-slate-700">Select Island</h2>
      <button
        id="closeAreasModal"
        class="w-8 h-8 flex items-center justify-center rounded-lg hover:bg-slate-100 active:bg-slate-200 transition text-slate-500 hover:text-slate-700"
        aria-label="Close"
      >
        <span class="text-2xl leading-none">&times;</span>
      </button>
    </div>

    <!-- Island Buttons -->
    <div class="p-6 space-y-3 max-h-[60vh] overflow-y-auto">
      {COUNTRIES.map((country) => (
        country.available ? (
          <a
            href={country.areasUrl}
            class="group relative bg-white/80 backdrop-blur-md border-2 border-slate-200 rounded-lg p-4 hover:border-rose-600 hover:shadow-lg transition-all duration-300 flex items-center justify-between"
          >
            <div>
              <h3 class="text-small font-bold text-slate-700 group-hover:text-rose-600 transition mb-1">
                {country.name}
              </h3>
              <p class="text-xs text-slate-500">{country.short}</p>
            </div>
            <svg class="w-5 h-5 text-slate-400 group-hover:text-rose-600 group-hover:translate-x-1 transition" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
            </svg>
          </a>
        ) : (
          <div class="relative bg-white/50 backdrop-blur-md border-2 border-slate-200 rounded-lg p-4 opacity-60 cursor-not-allowed flex items-center justify-between">
            <div>
              <h3 class="text-small font-bold text-slate-500 mb-1">
                {country.name}
              </h3>
              <p class="text-xs text-slate-400">{country.short}</p>
            </div>
            <svg class="w-5 h-5 text-slate-300" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z" />
            </svg>
          </div>
        )
      ))}
    </div>

    <!-- Footer Help Text -->
    <div class="px-6 pb-6 pt-2">
      <p class="text-xs text-slate-500 text-center">
        Don't see your island? <a href={routes.report} class="text-rose-600 hover:text-rose-700 underline">Submit a report</a> to help us expand.
      </p>
    </div>
  </div>
</div>

<script>
  const modal = document.getElementById('areasModal');
  const modalContent = document.getElementById('areasModalContent');
  const closeBtn = document.getElementById('closeAreasModal');

  // Global function to open modal (called from Header)
  window.openAreasModal = function() {
    if (modal && modalContent) {
      modal.classList.remove('invisible', 'opacity-0');
      modal.classList.add('visible', 'opacity-100');
      setTimeout(() => {
        modalContent.classList.remove('opacity-0', 'scale-95');
        modalContent.classList.add('opacity-100', 'scale-100');
      }, 50);
    }
  };

  // Close modal function
  function closeModal() {
    if (modal && modalContent) {
      modalContent.classList.remove('opacity-100', 'scale-100');
      modalContent.classList.add('opacity-0', 'scale-95');
      setTimeout(() => {
        modal.classList.remove('visible', 'opacity-100');
        modal.classList.add('invisible', 'opacity-0');
      }, 300);
    }
  }

  // Close button
  closeBtn?.addEventListener('click', closeModal);

  // Close on overlay click
  modal?.addEventListener('click', (e) => {
    if (e.target === modal) {
      closeModal();
    }
  });

  // Close on Escape key
  document.addEventListener('keydown', (e) => {
    if (e.key === 'Escape' && modal?.classList.contains('visible')) {
      closeModal();
    }
  });
</script>
