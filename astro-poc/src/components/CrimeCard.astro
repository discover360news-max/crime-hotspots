---
/**
 * Crime Card Component
 *
 * Displays individual crime incident in card format
 * Reusable across Headlines, Archive, Search
 *
 * Props:
 * - crime: Object with { date, crimeType, location, area, source, slug }
 * - localName: Optional local name for the area (shows tooltip on hover)
 */

import { getCrimeTailwindColor } from '../lib/crimeColors';
import AreaNameTooltip from './AreaNameTooltip.astro';

interface Props {
  crime: {
    date: string;
    headline: string;
    crimeType: string;
    primaryCrimeType?: string;
    relatedCrimeTypes?: string;
    victimCount?: number;
    location?: string;
    area: string;
    street?: string;
    region: string;
    source: string;
    url: string;
    summary?: string;
    slug: string;
    latitude?: number;
    longitude?: number;
  };
  localName?: string; // Optional local area name for tooltip
}

const { crime, localName } = Astro.props;

// Get crime type color (centralized utility)
const colorClass = getCrimeTailwindColor(crime.crimeType);

// Format date for display
const formatDate = (dateStr: string) => {
  const date = new Date(dateStr);
  return date.toLocaleDateString('en-US', {
    month: 'short',
    day: 'numeric',
    year: 'numeric'
  });
};
---

<article class="bg-white/85 dark:bg-[hsl(0_0%_8%)]/85 backdrop-blur-md rounded-xl shadow-md border border-slate-100 dark:border-[hsl(0_0%_15%)] p-4 hover:shadow-lg transition cursor-pointer group crime-card" data-crime-slug={crime.slug}>
  <!-- Crime Type Badge -->
  <div class="flex items-center justify-between mb-3">
    <span class={`inline-block px-3 py-1 rounded-full text-white text-caption font-bold ${colorClass} opacity-70`}>
      {crime.crimeType}
    </span>
    <span class="text-caption text-slate-400 dark:text-[hsl(0_0%_55%)]">
      {formatDate(crime.date)}
    </span>
  </div>

  <!-- Location -->
  <h3 class="text-body font-bold text-slate-700 dark:text-[hsl(0_0%_90%)] leading-snug mb-1">
    {crime.headline || crime.location}
  </h3>

  <!-- Area -->
  <p class="text-caption text-slate-500 dark:text-[hsl(0_0%_65%)] mb-3 flex items-center gap-1">
    <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z" />
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z" />
    </svg>
    <AreaNameTooltip area={crime.area} localName={localName} />
  </p>

  <!-- Actions -->
  <div class="flex items-center justify-between pt-3 border-t border-slate-200 dark:border-[hsl(0_0%_18%)]">
    <button
      class="text-caption text-rose-600 hover:text-rose-700 font-medium flex items-center gap-1 view-details-btn"
    >
      View Details
      <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
      </svg>
    </button>

    <a
      href={crime.url}
      target="_blank"
      rel="noopener"
      class="text-caption text-slate-500 dark:text-[hsl(0_0%_55%)] hover:text-slate-700 dark:hover:text-[hsl(0_0%_80%)] flex items-center gap-1 source-link"
      title="Read original article"
      onclick="event.stopPropagation()"
    >
      <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14" />
      </svg>
      Source
    </a>
  </div>
</article>
